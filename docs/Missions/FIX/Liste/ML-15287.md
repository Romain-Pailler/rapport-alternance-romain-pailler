---
sidebar_label: "ML-15287 – Rechargement inutile après fermeture de modale RIB/RUM"
sidebar_position: 5
tags:
  - Bug
  - Comptabilité
---

# Suppression du rechargement de la page RIB/RUM en cas de fermeture sans action

## Contexte

Sur la page de gestion des **RIB** et **[mandats RUM](../../../glossaire/Vocab_metier.md#couple-ribrum)**, les utilisateurs peuvent réaliser différentes opérations :

- Modifier ou sauvegarder un RIB
- Désactiver un RIB ou un mandat
- Générer manuellement un [mandat SEPA](../../../glossaire/Vocab_metier.md#mandat-sepa)

Ces actions s’effectuent via des **modales de confirmation**. Toutefois, un comportement inattendu avait été observé : même lorsqu’aucune action n’était validée (fermeture de la modale sans confirmation), l’interface rechargeait systématiquement la liste des couples RIB/RUM.

## Ticket

![Screenshot du ticket Jira](/img/fix/ml_15287.png)

## Problème

Le code appelait systématiquement la méthode `reloadCouplesRibRum()`, quel que soit le choix de l’utilisateur.  
Résultat : un **rafraîchissement visuel inutile** à chaque fermeture de modale, même en cas d’annulation.  
Ça rendait la navigation moins fluide et pouvait faire perdre le fil lorsqu’on parcourait plusieurs éléments à la suite.

## Correction

J’ai revu la logique pour que **le rechargement ne s’effectue que si l’utilisateur confirme réellement l’action**.

J’ai appliqué ce comportement cohérent à toutes les actions concernées :

- Sauvegarde d’un RIB
- Désactivation d’un mandat
- Désactivation d’un RIB
- Renouvellement manuel d’un mandat SEPA

:::info
Le code source se trouve [ici](../../../annexes/bout_de_code/FIX/ML-15287.md)
:::
### Détail technique

Voici les principaux ajustements que j’ai apportés côté Angular :

- J’ai utilisé `filter()` de **RxJS** pour m’assurer que le traitement continue **uniquement si la réponse est positive**.

```ts
.afterClosed()
.pipe(
  filter((result) => !!result) // continue uniquement si action confirmée
)
```

- J’ai introduit un booléen `canReload` pour bien **contrôler quand relancer le rafraîchissement**.

```ts
let canReload = false;
mergeMap(() => {
  canReload = true; // on autorise le reload uniquement après confirmation
  return this.createOrUpdateInfoPrelevement(coupleRibRum.informationPrelevement);
})

```

- Le `subscribe()` ne déclenche le `reloadCouplesRibRum()` **que si l’action a été réellement confirmée**.

```ts
subscribe({
  complete: () => {
    if (canReload) {
      this.reloadCouplesRibRum();
    }
  }
})
```

- J’en ai profité pour améliorer un peu la gestion des erreurs via le `GlobalAlertService`.

## Résultat

Depuis cette correction, **la liste des RIB/RUM ne se recharge plus pour rien**.  
Ça allège les appels serveurs, fluidifie l’expérience utilisateur, et surtout évite des effets visuels inutiles.  

<video controls width="100%">
  <source src="/videos/ml_15287.mp4" type="video/mp4"/>
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

---
