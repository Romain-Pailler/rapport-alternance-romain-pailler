---
sidebar_label: "ML-14747 – Recalcul de la tuile Contrats en relocation"
sidebar_position: 7
tags:
  - Feature
  - Dashboard
  - Leasa
---

# Recalcul de la tuile "Contrats en relocation" sur la page d’accueil

## Contexte

Sur la page d’accueil de l’application Leasa, un ensemble de **tuiles informatives** permet de visualiser rapidement l’état d’avancement des différents dossiers de financements : contrats en vie, dossiers à étudier, mises en place, etc. Parmi celles-ci, la tuile **"[Contrats en relocation](../../../glossaire/Vocab_metier.md#contrat-en-relocation)"** affiche le nombre de dossiers en cours de traitement dans le cadre d’une relocation.

La relocation correspond à un processus par lequel un contrat de location est interrompu de manière anticipée et doit être remplacé par un nouveau financement. Elle intervient en général à l’initiative du client ou du fournisseur, dans le cadre d’un renouvellement, d’un changement de matériel ou d’un réaménagement de contrat.

## Ticket

![Screenshot du ticket depuis Jira](/img/fix/ml_14747.png)

## Besoin

Avant ma correction, la tuile **"Contrats en relocation"** affichait un total qui incluait **toutes les tâches de type relocation**, qu'elles soient **ouvertes ou fermées**. Cette logique faussait le chiffre affiché et pouvait laisser penser que davantage de dossiers de financements étaient en cours de traitement qu’en réalité.

## Correction

Pour rendre cette tuile plus fidèle à la situation réelle, j’ai revu entièrement la logique de calcul afin de ne prendre en compte **que les dossiers ayant au moins une tâche "Relocation" encore ouverte**.

### Ce que j’ai ajusté

- **Filtrage par état de tâche** :  
  J’ai appliqué un filtrage strict pour exclure toutes les tâches clôturées. Seules les tâches actives sont maintenant comptabilisées.

- **Éviter les doublons** :  
  J’ai ajouté une logique pour ne pas compter plusieurs fois un même dossier lorsqu’il contient plusieurs tâches ouvertes de relocation.

- **Ajout d’un champ dans les critères** :  
  J’ai introduit un nouveau champ `tacheOuverte` dans l’objet `StatistiqueDemandeCriteria`, permettant un filtrage clair selon l’état de la tâche côté backend.

- **Alignement avec les autres filtres de la page** :  
  J’ai aussi veillé à ce que ce recalcul respecte les filtres globaux définis par l’utilisateur (portefeuille, société, etc.) pour que les chiffres restent cohérents avec le reste du tableau de bord.

### accueil.component.ts

```ts
public informationTuileContratsRelocation = new InformationTuileDemande(BackOfficeTileEnum.ContratsRelocation, {
    origineTache: ORIGINE_TACHE.RELOCATION,
    categoriesTache: CATEGORIE_TACHE.VIE_CONTRAT,
    tacheOuverte: true,
  });
```

### statistique.service.ts

```ts
export class StatistiqueDemandeCriteria extends TuileRechercheCriteria {
  incidentPaiement: booleanCriteria;
  statut: stringTabCriteria;
  statutContrat: stringTabCriteria;
  codePortefeuille: stringCriteria;
  codePreSelection: stringCriteria;
  origineTache: stringTabCriteria;
  categoriesTache: stringTabCriteria;
  tacheOuverte: booleanCriteria;
}
```

## Résultat

![Capture de la tuile Contrats en relocation](ml_14747.png)

## Conclusion

Cette correction m’a permis de mieux comprendre le fonctionnement du tableau de bord Leasa et la logique des statistiques liées aux tâches.

---
