---
sidebar_label: "ML-14950 – Problème de filtrage par compte dans la recherche de relevé"
sidebar_position: 4
tags:
  - Bug
  - Leasa
---

# Problème de filtrage des relevés bancaires par compte

## Contexte

Dans l’écran **"Consulter un relevé bancaire"** (*Trésorerie > Relevé bancaire*), les gestionnaires peuvent voir toutes les opérations bancaires liées aux bailleurs : virements reçus, prélèvements rejetés, affectations comptables, etc.  
C’est un écran important pour le suivi quotidien des flux financiers et pour faire le rapprochement entre les mouvements bancaires et les écritures comptables.

On y retrouve plusieurs filtres pour faciliter la recherche : montants, dates, statut de lettrage, numéro externe, bailleur… mais aussi la **banque** et le **compte bancaire** associé.

## Ticket

![Screenshot du ticket depuis Jira](/img/fix/ml_14950.png)

## Problème

Avant ma correction, il était possible de choisir un **compte** sans avoir sélectionné de **banque**.  
Ça posait problème car les comptes affichés n’étaient pas reliés à une banque précise et pouvait donner des résultats incohérents ou vides.  
En plus, le champ "Compte" restait actif et pouvait afficher des informations incomplètes ce pouvait induire les utilisateurs en erreur.

### Vidéo ajouté au ticket

<video controls width="100%">
  <source src="/videos/ml_14950.mp4" type="video/mp4"/>
  Votre navigateur ne supporte pas la vidéo HTML5.
</video>

## Ma correction

J’ai modifié la logique de filtrage pour éviter ces incohérences :  

- Le champ "Compte bancaire" n’apparaît et n’est actif **que si** une banque est sélectionnée.
- Quand la banque change, le champ "Compte" se réinitialise automatiquement pour éviter de garder une ancienne valeur qui ne correspond plus.  
- J’ai aussi ajusté l’affichage pour que ce soit plus clair et plus fluide pour l’utilisateur.

### consulter-releve-banacaire.component.html

```html
      @if (isBanqueSelected) {
                            <div class="uiu-1-4">
                                <ml-ui-form-field>
                                    <ml-ui-label i18n>Compte</ml-ui-label>
                                    <ml-ui-select [filterable]="false" formControlName="idCompteBancaire">
                                        <ml-ui-option [value]="null" i18n>- Compte -</ml-ui-option>
                                        @for (compteBancaire of comptesBanques; track compteBancaire.compte){
                                        <ml-ui-option
                                            [value]="compteBancaire.id">{{ compteBancaire.compte + ' ' + compteBancaire.libelleLoueur }}
                                        </ml-ui-option>
                                        }
                                    </ml-ui-select>
                                </ml-ui-form-field>
                            </div>
                        }
```

### consulter-releve-bancaire.component.ts

```ts
public isBanqueSelected: boolean = false;

this.updateComptesBancaires(this.formGroupReleveBancaireCriteria.controls.listeLoueurs.value!);
        this.isBanqueSelected = change !== null;
        this.formGroupReleveBancaireCriteria.get('idCompteBancaire')!.reset();
      });
```

## Conclusion

C’était une correction assez rapide à mettre en place, mais qui améliore vraiment l’ergonomie de l’écran et offre un confort aux utilisateurs d'avoir une recherche fiable.

---
