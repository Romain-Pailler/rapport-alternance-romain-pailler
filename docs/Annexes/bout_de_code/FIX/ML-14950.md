---
sidebar_label: "ML-14950 – Code source"
sidebar_position: 4
tags:
  - Bug
  - Leasa
  - Code
---

# Code source

## consulter-releve-banacaire.component.html

```html
<div class="page-header-leasa">
    <h1 i18n>Consulter un relevé bancaire</h1>
</div>
@if (!formGroupLoading) {
    <ml-ui-bloc class="recherche-releve__filtres" [foldable]="true" [folded]="false">
        <ml-ui-bloc-title i18n>Filtres</ml-ui-bloc-title>
        <ml-ui-bloc-body>
            <form (ngSubmit)="search()" [formGroup]="formGroupReleveBancaireCriteria" *mlUiSkeleton="formGroupLoading; template: 'label-input'; repeat: 10">
                <div class="uig uis">
                    @if (loueurs.length > 1) {
                        <div class="uiu-1-4">
                            <ml-ui-form-field>
                                <ml-ui-label i18n>Société</ml-ui-label>
                                <ml-ui-select [filterable]="false" formControlName="listeLoueurs">
                                    <ml-ui-option [value]="null" i18n>- Société -</ml-ui-option>
                                    @for (loueur of loueurs; track loueur.libelle){
                                        <ml-ui-option  [value]="loueur.id">{{ loueur.libelle }}</ml-ui-option>
                                    }
                                </ml-ui-select>
                            </ml-ui-form-field>
                        </div>
                    }
                    @if (apporteurs.length > 1 && loueurs.length > 1) {
                        <div class="uiu-1-4">
                            <ml-ui-form-field>
                                <ml-ui-label i18n>Affectation apporteur</ml-ui-label>
                                <ml-ui-select [filterable]="false" formControlName="entiteId">
                                    <ml-ui-option [value]="null" i18n>- Apporteur -</ml-ui-option>
                                    @for (apporteur of apporteurs; track apporteur.libelle){
                                        <ml-ui-option [value]="apporteur.id">{{ apporteur.libelle }}</ml-ui-option>
                                    }
                                </ml-ui-select>
                            </ml-ui-form-field>
                        </div>
                    }
                    @if (showLoueurCriteria) {
                        <div class="uiu-1-4">
                            <ml-ui-form-field>
                                <ml-ui-label i18n>Banque</ml-ui-label>
                                <ml-ui-select [filterable]="false" formControlName="idBanque">
                                    <ml-ui-option [value]="null" i18n>- Banque -</ml-ui-option>
                                    @for (banque of banques; track banque.nom){
                                        <ml-ui-option [value]="banque.id">{{ banque.nom }}</ml-ui-option>
                                    }
                                </ml-ui-select>
                            </ml-ui-form-field>
                        </div>
                        @if (isBanqueSelected) {
                            <div class="uiu-1-4">
                                <ml-ui-form-field>
                                    <ml-ui-label i18n>Compte</ml-ui-label>
                                    <ml-ui-select [filterable]="false" formControlName="idCompteBancaire">
                                        <ml-ui-option [value]="null" i18n>- Compte -</ml-ui-option>
                                        @for (compteBancaire of comptesBanques; track compteBancaire.compte){
                                        <ml-ui-option
                                            [value]="compteBancaire.id">{{ compteBancaire.compte + ' ' + compteBancaire.libelleLoueur }}
                                        </ml-ui-option>
                                        }
                                    </ml-ui-select>
                                </ml-ui-form-field>
                            </div>
                        }
                    }
                </div>
                <div class="uig uis">
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>N° externe (relevé)</ml-ui-label>
                            <input type="text" formControlName="numeroExterne" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>N° interne (relevé)</ml-ui-label>
                            <input type="text" formControlName="numeroInterne" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Entre date...</ml-ui-label>
                            <input mlUiCalendarModelFormat="timestamp" formControlName="dateDebut" mlUiInput [mlUiCalendar]="calendarDateDebut"/>
                            <ml-ui-calendar-toggle [for]="calendarDateDebut" mlUiSuffix></ml-ui-calendar-toggle>
                            <ml-ui-calendar #calendarDateDebut></ml-ui-calendar>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>... et date</ml-ui-label>
                            <input mlUiCalendarModelFormat="timestamp" formControlName="dateFin" mlUiInput [mlUiCalendar]="calendarDateFin"/>
                            <ml-ui-calendar-toggle [for]="calendarDateFin" mlUiSuffix></ml-ui-calendar-toggle>
                            <ml-ui-calendar #calendarDateFin></ml-ui-calendar>
                        </ml-ui-form-field>
                    </div>
                </div>
                <div class="uig uis">
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Montant entre</ml-ui-label>
                            <input type="text" formControlName="montantMin" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>et ...</ml-ui-label>
                            <input type="text" formControlName="montantMax" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Tresorerie manuelle</ml-ui-label>
                            <ml-ui-checkbox
                                    [checked]="tresorerieManuelle"
                                    (checkedChange)="onCheckChange()">
                            </ml-ui-checkbox>
                        </ml-ui-form-field>
                    </div>
                </div>
                <div class="uig uis">
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>N° de ligne de relevé</ml-ui-label>
                            <input type="text" formControlName="id" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Sens</ml-ui-label>
                            <ml-ui-select [filterable]="false" formControlName="sens">
                                <ml-ui-option [value]="null" i18n>- Sens -</ml-ui-option>
                                <ml-ui-option value="Debit">Débit</ml-ui-option>
                                <ml-ui-option value="Crédit">Crédit</ml-ui-option>
                            </ml-ui-select>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Statut lettrage</ml-ui-label>
                            <ml-ui-select [filterable]="false" formControlName="statutLettrage">
                                <ml-ui-option [value]="null" i18n>- Statut lettrage -</ml-ui-option>
                                <ml-ui-option value="Lettre">Lettré</ml-ui-option>
                                <ml-ui-option value="NonLettre">Non lettré</ml-ui-option>
                            </ml-ui-select>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Code opérationel interbancaire</ml-ui-label>
                            <ml-ui-select [filterable]="true" formControlName="codeCfonb">
                                <ml-ui-option [value]="null" i18n>- Code opérationel interbancaire -</ml-ui-option>
                                @for (codeCFONB of codesCFONB; track codeCFONB.code){
                                    <ml-ui-option
                                                  [value]="codeCFONB.code">{{ codeCFONB.code + ' - ' + codeCFONB.libelle }}
                                    </ml-ui-option>
                                }
                            </ml-ui-select>
                        </ml-ui-form-field>
                    </div>
                </div>
                <div class="uig uis">
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Décodification pièce</ml-ui-label>
                            <input type="text" formControlName="decodificationPiece" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Décodification Leasa</ml-ui-label>
                            <input type="text" formControlName="decodification" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Affectation pièce</ml-ui-label>
                            <input type="text" formControlName="numPieceComptable" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Affectation demande</ml-ui-label>
                            <input type="text" formControlName="codeDemande" mlUiInput/>
                        </ml-ui-form-field>
                    </div>

                </div>
                <div class="uig uis">
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Date de règlement</ml-ui-label>
                            <input mlUiCalendarModelFormat="timestamp" formControlName="dateReglement" mlUiInput [mlUiCalendar]="calendarDateReglement"/>
                            <ml-ui-calendar-toggle [for]="calendarDateReglement" mlUiSuffix></ml-ui-calendar-toggle>
                            <ml-ui-calendar #calendarDateReglement></ml-ui-calendar>
                        </ml-ui-form-field>
                    </div>
                    <div class="uiu-1-4">
                        <ml-ui-form-field>
                            <ml-ui-label i18n>Numéro de virement</ml-ui-label>
                            <input type="text" formControlName="numVirement" mlUiInput/>
                        </ml-ui-form-field>
                    </div>
                </div>
                <div class="recherche-releve__filtres__btn-bottom">
                    <button type="button" (click)="reinit()" mlUiButton variant="secondary">
                        <ml-ui-icon icon="refresh"></ml-ui-icon>
                        <span i18n>Réinitialiser</span>
                    </button>
                    <button type="submit" mlUiButton>
                        <ml-ui-icon icon="search"></ml-ui-icon>
                        <span i18n>Rechercher</span>
                    </button>
                </div>
            </form>
        </ml-ui-bloc-body>
    </ml-ui-bloc>
}
@if (detailReleve) {
    <ml-ui-bloc class="recherche-releve__filtres">
        <ml-ui-bloc-title i18n> Détail du relevé</ml-ui-bloc-title>
        <ml-ui-bloc-body>
            <div class="uig uis">
                <div class="uiu-1-4">
                    <ml-ui-form-field>
                        <ml-ui-label i18n>Société</ml-ui-label>
                        <ml-ui-data>{{ detailReleve.societe }}</ml-ui-data>
                    </ml-ui-form-field>
                </div>
                <div class="uiu-1-4">
                    <ml-ui-form-field>
                        <ml-ui-label i18n>Banque</ml-ui-label>
                        <ml-ui-data>{{ detailReleve.banque }}</ml-ui-data>
                    </ml-ui-form-field>
                </div>
                <div class="uiu-1-4">
                    <ml-ui-form-field>
                        <ml-ui-label i18n>Compte</ml-ui-label>
                        <ml-ui-data>{{ detailReleve.compte }}</ml-ui-data>
                    </ml-ui-form-field>
                </div>
                <div class="uiu-1-4">
                    <ml-ui-form-field>
                        <ml-ui-label i18n>Numéro externe</ml-ui-label>
                        <ml-ui-data>{{ detailReleve.numeroExterne }}</ml-ui-data>
                    </ml-ui-form-field>
                </div>
            </div>
            <div class="uig uis">
                <div class="uiu-1-4">
                    <ml-ui-form-field>
                        <ml-ui-label i18n>Numéro interne</ml-ui-label>
                        <ml-ui-data>{{ detailReleve.numeroInterne }}</ml-ui-data>
                    </ml-ui-form-field>
                </div>
            </div>
        </ml-ui-bloc-body>
    </ml-ui-bloc>
}
<ml-ui-bloc class="recherche-releve__resultat" [class.hide]="!showSearchResult">
    <div *ngIf="numberTotalElement > 0 && !searchLoading" #anchorResults></div>
    <ml-ui-bloc-title [class.hide]="numberTotalElement <= 0" i18n> Résultats</ml-ui-bloc-title>
    <ml-ui-bloc-body>
        <div class="recherche-releve__resultat__table" [class]="{hide: numberTotalElement <= 0}">
            <table ml-ui-table [dataSource]="releveBancaireDatasource" aria-label="Résultat de la recherche de releve bancaire"
                   [class.hide]="numberTotalElement <= 0 || searchLoading">

                <ng-container mlUiColumnDef="numero">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>N°</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        {{ ligne.id }}
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="date">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Date</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        {{ ligne.dateOperation | date: "shortDate" }}
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="dateValeur">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Valeur</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        {{ ligne.dateValeur | date: "shortDate" }}
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="libelle">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Libellé</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        {{ ligne.libelle }}
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="debit">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Débit</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        {{ ligne.debit | number:"1.2-2" }}
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="credit">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Crédit</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">{{ ligne.credit | number:"1.2-2" }}</td>
                </ng-container>
                <ng-container mlUiColumnDef="decodification">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Décodification Leasa</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">{{ ligne.decodification }}</td>
                </ng-container>
                <ng-container mlUiColumnDef="decodificationPiece">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Décodification Pièce</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">{{ ligne.decodificationPiece }}</td>
                </ng-container>
                <ng-container mlUiColumnDef="facturesAffectees">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Affectation pièce</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        <div *ngFor="let facture of ligne.facturesAffectees">
                            {{ facture.numeroFacture }}
                        </div>
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="demandesAffectees">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Affectation demande</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        <div *ngFor="let demande of ligne.demandesAffectees">
                            <a class="clickable" href="#/dossier/{{ demande.code }}/synthese">
                                <b>{{ demande.code }}</b>
                            </a>
                        </div>
                    </td>
                </ng-container>
                <ng-container mlUiColumnDef="numVirement">
                    <th ml-ui-header-cell *mlUiHeaderCellDef i18n>Numéro de virement</th>
                    <td ml-ui-cell *mlUiCellDef="let ligne">
                        <a class="clickable" href="extractionPaiements({numVirement: ligne.numVirement})">
                            <b>{{ ligne.numVirement }}</b>
                        </a>
                    </td>
                </ng-container>
                <tr ml-ui-header-row *mlUiHeaderRowDef="columns"></tr>
                <tr ml-ui-row *mlUiRowDef="let row; columns: columns"></tr>
            </table>
            @if (!searchLoading) {
                <div style="padding-left: 15px">
            <span>
                <b i18n>Solde débit : </b>{{ sommeDebit | currency: devise : "symbol-narrow" }}
            </span><br>
                    <span>
                <b i18n>Solde crédit : </b>{{ sommeCredit | currency: devise : "symbol-narrow" }}
            </span><br>
                    <span>
                <b i18n>Solde du compte : </b>{{ sommeDebit - sommeCredit | currency: devise : "symbol-narrow" }}
            </span>
                </div>
            }
        </div>
        <div
                *mlUiSkeleton="
      searchLoading;
      template: 'table';
      options: {style: {width: '100%'}, column: columns.length, row: 10}
    "
        ></div>
        <div [class.hide]="numberTotalElement > 0 || searchLoading" i18n>Aucun résultat pour cette recherche.</div>
        <ml-ui-paginator
                [length]="numberTotalElement"
                [pageSize]="10"
                [indexPage]="numberPage"
                (page)="searchPage($event + 1)"
                #paginator
        ></ml-ui-paginator>
    </ml-ui-bloc-body>
</ml-ui-bloc>
```

## consulter-releve-bancaire.component.ts

```ts
import {Component, DestroyRef, ElementRef, OnInit, ViewChild} from '@angular/core';
import {Loueur} from '../../models/Loueur';
import {ComptabiliteService} from '../../releve-bancaire/service/comptabilite.service';
import {LoueurService} from '../../shared/service/loueur/loueur.service';
import {
  Apporteur,
  DetailReleveDomain,
  CompteBancaireDomain,
  BanqueDomain,
  StatutTransfertDomain,
  CodeCfonbDomain,
} from '@leasa/rest-api-angular';
import {ReactiveFormsModule} from '@angular/forms';
import {ReleveBancaireDatasource} from '../releve-bancaire.datasource';
import {ModalModule, MonalisaUIModule, PaginatorComponent} from '@leasa/ui';
import {ApporteurService} from '../../core/service/current-user/apporteur/apporteur.service';
import {CurrentUserService} from '../../core/service/current-user/current-user.service';
import {ReleveBancaireCriteriaFactory} from '../releve-bancaire-criteria';
import {takeUntilDestroyed} from '@angular/core/rxjs-interop';
import {CurrencyPipe, DatePipe, DecimalPipe, NgFor, NgIf} from '@angular/common';

@Component({
  selector: 'ml-consulter-releve-bancaire',
  standalone: true,
  imports: [ModalModule, MonalisaUIModule, NgIf, NgFor, ReactiveFormsModule, DatePipe, DecimalPipe, CurrencyPipe],
  templateUrl: './consulter-releve-bancaire.component.html',
  styleUrls: ['./consulter-releve-bancaire.component.scss'],
})
export class ConsulterReleveBancaireComponent implements OnInit {
  @ViewChild('anchorResults') anchorResults: ElementRef;
  @ViewChild('paginator') paginator: PaginatorComponent;

  public searchLoading: boolean = false;
  public releveBancaireDatasource: ReleveBancaireDatasource;
  public columns = [
    'numero',
    'date',
    'dateValeur',
    'libelle',
    'debit',
    'credit',
    'decodification',
    'decodificationPiece',
    'facturesAffectees',
    'demandesAffectees',
    'numVirement',
  ];
  public loueurs: Loueur[] = [];
  public apporteurs: Apporteur[] = [];
  public apporteursSaved: Apporteur[] = [];
  public banques: BanqueDomain[] = [];
  //a retyper
  public comptesBanques: any[] = [];
  public detailReleve: DetailReleveDomain | null;
  public codesCFONB: CodeCfonbDomain[];

  public numberPage: number;
  public sommeDebit: number;
  public sommeCredit: number;
  public numberTotalElement: number;
  public statuts: StatutTransfertDomain[];
  public formGroupReleveBancaireCriteria: ReturnType<typeof ReleveBancaireCriteriaFactory.build>;
  public criteresComptesBancaire: any;
  public hasRightSearchCustomerByRenter: boolean = false;
  public showLoueurCriteria: boolean = false;
  public isBanqueSelected: boolean = false;
  public tresorerieManuelle: boolean = false;
  public devise: string = 'EUR';

  protected filtresCollapsed: boolean = false;
  protected formGroupLoading: boolean = true;
  protected showSearchResult: boolean = false;

  constructor(
    private loueurService: LoueurService,
    private comptabiliteService: ComptabiliteService,
    private apporteurService: ApporteurService,
    private currentUserService: CurrentUserService,
    private destroyRef: DestroyRef,
  ) {}

  ngOnInit() {
    this.initDataSource();
    this.initLoueursSelected();
    this.initFormGroup();
    this.currentUserService
      .hasDroit('ADMINISTRATION.REPOSITORY.CUSTOMERS.SEARCH_BY_RENTER.READ')
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((droit) => (this.hasRightSearchCustomerByRenter = droit));
    this.apporteurService
      .getApporteursFromCurrentUser()
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((apporteursResult) => {
        this.apporteurs = apporteursResult;
        this.apporteursSaved = apporteursResult;
      });
    this.comptabiliteService
      .getCodeCfonb()
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((listeCode) => {
        this.codesCFONB = listeCode;
      });
  }

  /**
   * Initialise les value change du formGroup
   *
   * @private
   */
  private initFormGroup(): void {
    this.formGroupReleveBancaireCriteria = ReleveBancaireCriteriaFactory.build();
    this.formGroupLoading = false;
    this.formGroupReleveBancaireCriteria.controls.listeLoueurs.valueChanges
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((change) => {
        this.showLoueurCriteria = change != null;
        this.formGroupReleveBancaireCriteria.controls.entiteId.reset();
        this.formGroupReleveBancaireCriteria.controls.idBanque.reset();
        this.formGroupReleveBancaireCriteria.controls.idCompteBancaire.reset();
        this.updateAffectationApporteur(change);
        if (change != null) {
          this.devise = this.loueurs.filter(
            (loueur) => loueur.id == (typeof change === 'number' ? change : change[0]),
          )[0].devise;
          this.updateBanques(change as number);
          this.updateComptesBancaires(change);
        }
      });
    this.formGroupReleveBancaireCriteria.controls.idBanque.valueChanges
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((change) => {
        this.updateComptesBancaires(this.formGroupReleveBancaireCriteria.controls.listeLoueurs.value!);
        this.isBanqueSelected = change !== null;
        this.formGroupReleveBancaireCriteria.get('idCompteBancaire')!.reset();
      });
  }

  public onCheckChange() {
    this.tresorerieManuelle = !this.tresorerieManuelle;
    this.formGroupReleveBancaireCriteria.controls.tresorerieManuelle.setValue(this.tresorerieManuelle);
  }

  /**
   * Initialise la data source
   *
   * @private
   */
  private initDataSource(): void {
    this.releveBancaireDatasource = new ReleveBancaireDatasource(this.comptabiliteService);
    this.releveBancaireDatasource.numberPage$
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((value) => (this.numberPage = value));
    this.releveBancaireDatasource.numberTotalElement$.pipe(takeUntilDestroyed(this.destroyRef)).subscribe((value) => {
      this.numberTotalElement = value;
      if (!this.showSearchResult) {
        this.showSearchResult = this.numberTotalElement >= 0;
      }
      if (this.numberTotalElement > 0) {
        this.scrollToResults();
      }
    });
    this.releveBancaireDatasource.loading$
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((value) => (this.searchLoading = value));
  }

  /**
   * Initialise les loueurs
   *
   * @private
   */
  private initLoueursSelected(): void {
    this.loueurService
      .getLoueursSelectedObservable()
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((loueursResult) => {
        this.loueurs = loueursResult;
      });
  }

  private updateBanques(idLoueur: number): void {
    this.loueurService
      .searchBanques(idLoueur)
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((banqueResult: BanqueDomain[]) => {
        this.banques = banqueResult;
      });
  }

  private updateComptesBancaires(idLoueur: number | number[]): void {
    this.criteresComptesBancaire = {
      banqueId: this.formGroupReleveBancaireCriteria.controls.idBanque.value,
      loueurId: idLoueur,
    };

    this.comptabiliteService
      .searchComptesBancaires(this.criteresComptesBancaire)
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((banqueResult: CompteBancaireDomain[]) => {
        this.comptesBanques = banqueResult;
      });
  }

  private updateAffectationApporteur(idLoueur: null | number | number[]): void {
    this.apporteurs = this.apporteursSaved;
    if (idLoueur != null) {
      this.apporteurs = this.apporteursSaved.filter(
        (apporteur) => apporteur.loueur.id === this.formGroupReleveBancaireCriteria.controls.listeLoueurs.value,
      );
    }
  }

  /**
   * Réinitialisation des critères de recherche releve
   */
  reinit() {
    this.showSearchResult = false;
    this.formGroupReleveBancaireCriteria.reset();
    this.releveBancaireDatasource.reinit();
  }

  /**
   * Lance la recherche releve (sur la page 0)
   */
  search() {
    this.searchPage(0);
    this.showSearchResult = true;
  }

  /**
   * Lance la recherche releve sur la page souhaitée
   *
   * @param index le numéro de la page
   */
  searchPage(index: number) {
    // TODO supprimer lorsque le cloisonnement loueur sera fait côté serveur
    const criteria = Object.assign({}, this.formGroupReleveBancaireCriteria.value);
    if (this.formGroupReleveBancaireCriteria.value.listeLoueurs === null) {
      Object.assign(criteria, {
        listeLoueurs: this.loueurs.map((loueur) => loueur.id),
      });
    }
    this.releveBancaireDatasource.searchReleve(criteria, index);
    this.comptabiliteService
      .getDetailReleve(criteria)
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((detail) => {
        this.detailReleve = detail;
      });
    this.comptabiliteService
      .getSommeCredit(criteria)
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((somme: number) => {
        this.sommeCredit = somme;
      });
    this.comptabiliteService
      .getSommeDebit(criteria)
      .pipe(takeUntilDestroyed(this.destroyRef))
      .subscribe((somme: number) => {
        this.sommeDebit = somme;
      });
  }

  /**
   * Descend la vue vers le résultat de recherche
   */
  scrollToResults() {
    this.anchorResults.nativeElement.scrollIntoView();
  }
}
```

## consulter-releve-bancaire.component.spec.ts

```ts
  it('should select banque and reset formGroup[idCompteBancaire]', function () {
    //GIVEN
    const formGroup = component['formGroupReleveBancaireCriteria'];

    formGroup.controls['idBanque'].setValue(5);
    formGroup.controls['idCompteBancaire'].setValue(10);

    expect(component.isBanqueSelected).toBe(true);
    expect(formGroup.controls['idCompteBancaire'].value).not.toBeNull();
    const idBanque = banques[0].id!;
    //WHEN
    formGroup.controls['idBanque'].setValue(idBanque);
    //THEN
    expect(formGroup.controls['idCompteBancaire'].value).toBeNull();
    expect(component.isBanqueSelected).toBe(true);
  });
  it('should select banque as null and reset formGroup[idCompteBancaire] and isBanqueSelected be falsy', function () {
    //GIVEN
    const formGroup = component['formGroupReleveBancaireCriteria'];

    formGroup.controls['idBanque'].setValue(5);
    formGroup.controls['idCompteBancaire'].setValue(10);

    expect(component.isBanqueSelected).toBe(true);
    expect(formGroup.controls['idCompteBancaire'].value).not.toBeNull();

    //WHEN
    formGroup.controls['idBanque'].setValue(null);
    //THEN
    expect(formGroup.controls['idCompteBancaire'].value).toBeNull();
    expect(component.isBanqueSelected).toBe(false);
  });
```
